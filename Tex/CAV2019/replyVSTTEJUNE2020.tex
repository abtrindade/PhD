\documentclass[11pt]{article}

\usepackage[normalem]{ulem}
\usepackage[english]{babel}
\usepackage[latin1]{inputenc}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{epstopdf}
\usepackage{url}
%\usepackage{mathtools}
\usepackage{enumerate}
\usepackage[nodayofweek]{datetime}
\usepackage[caption=false]{subfig}
%\mathtoolsset{showonlyrefs}
\usepackage[linesnumbered,lined,ruled,boxed]{algorithm2e}
\SetKw{KwBy}{by}
\usepackage{xcolor}
%\input{rgbcolors}
%\usepackage{color}
\usepackage{natbib}
% \usepackage[style=authoryear-comp,dashed=false]{biblatex}
% \bibliography{piecewise_lyapunov}
\newtheorem{myassumption}{Assumption}
\newcommand{\mstitle}{Synthesis of Solar Photovoltaic Systems: Optimal Sizing Comparison}
\newcommand{\refnumber}{Paper 14}
\newenvironment{resposta}{~~~\begin{quote}\color{blue}\textbf{Response:}}{\end{quote}}
\newcommand{\comment}[1]{}
%\definecolor{DarkGreen}{rgb}{0.2, 0.4, 0.2}
\usepackage{amsmath}
\usepackage{listings}
\lstset{language=C,basicstyle=\small\ttfamily}
\usepackage{tikz}
\usetikzlibrary{positioning, automata, shapes.arrows, calc, shapes, arrows, calc,patterns,decorations.pathmorphing,decorations.markings}

\newcommand{\param}[2]{\ensuremath{\langle{#1},{#2}\rangle}\xspace}
\textwidth 15cm
\setlength{\textheight}{1.1\textheight}
\newcommand\hi{\hspace*{\parindent}}
\newcommand\vi{\vspace{\baselineskip}}
\newcommand\lac{{\mbox{{\Huge\bf L}\hspace{-0.65em}
\raisebox{-1.2ex}{\Huge\bf A}\hspace{-1.1em}
\raisebox{-0.6ex}{\Huge\bf C~}}}}
\newcommand{\fwlfunction}[1]{\mathcal{FWL}[#1]}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\lhead{Manuscript Reference Number: \refnumber}
\rhead{Page \thepage\ of \pageref{LastPage}}
\lfoot{}
\rfoot{}

%\pagestyle{headings}
\pagenumbering{roman}
\begin{document}
\setcounter{page}{1}
\thispagestyle{empty}


\hoffset -1.5cm \voffset .5cm


\sf

\vspace*{-2.5cm} \hspace*{-0.1cm} {\small
{\mbox{\begin{minipage}{2cm}
\centerline{\includegraphics[width=1.5cm]{ufam_logo.png}}
\end{minipage}}} \hspace*{0.1cm}
\begin{minipage}{11.0cm}{\large \textbf{Federal University of Amazonas}}\\
{\sc Faculty of Technology}\\
{\sc Department of Electricity}
\end{minipage}
} \vspace*{0mm}

\hspace*{-.7cm} {\rule[-1ex]{15cm}{0.03cm}}

\begin{flushright}
\begin{minipage}{7.0cm}\small
{\bf Please Reply to:}\\
Adjunct Professor Alessandro Trindade\\
Universidade Federal do Amazonas\\
Departamento de Eletricidade\\
Av. Gal. Rodrigo Otávio, 3000, Japiim, Campus Universitário\\
ZIP 69077-000, Manaus - AM, Brazil\\
{\em alessandrotrindade@ufam.edu.br}
\end{minipage}
\end{flushright}
 
\vi
\hspace*{\fill}{\small Manaus, \today.}
\vi



\begin{flushleft}
	Nadia Polikarpova and Maria Christakis \\
	PC co-chairs,\\
	VSTTE'20
    \end{flushleft}
\vi

\begin{flushleft}
\textbf{REF.:} \refnumber
    \end{flushleft}
\vi \vi
 
\indent Dear Nadia Polikarpova and Maria Christakis,
\vi 

We thank you for asking us to comply with your reviewers' reports. We are submitting a revised version of our manuscript entitled  ``{\em \mstitle}'' by Alessandro Trindade and Lucas Cordeiro.  This revised version carefully addresses each comment provided by the reviewers, as suggested in the original notification.  In particular, our reply letter describes all modifications we have made to our manuscript and the respective responses to the comments raised by the reviewers.  

%\vi

%Thank you very much in advance.

\vi\vi

\indent
Sincerely,\\



\begin{quote}
\begin{quote}
\begin{flushright}


\vi
\vi

Alessandro B. Trindade~~~~~~~
\end{flushright}
\end{quote}
\end{quote}

\hoffset -1.5cm \voffset .5cm


% =============================================
\newpage
\subsection*{Authors'  Response to the Review Comments on manuscript ``{\mstitle}'' -- Manuscript Reference Number: \refnumber}

\vi

The authors would like to thank the anonymous reviewers for their valuable and constructive comments and suggestions, which helped us significantly improve our manuscript quality. 

According to the reviewers' comments, our manuscript was carefully revised, and all detailed changes are highlighted in blue color, along with the original text. The revision included the Abstract, Introduction, Background, Synthesizing Optimal Sizing, Results, and Conclusions sections.

Our responses to all comments (in blue color) are given in the sequel, with clear indications about how and where they were addressed in our manuscript.

We hope those modifications in our manuscript and our responses are sufficient to make our work suitable for publication in the \textbf{12th Working Conference on Verified Software: Theories, Tools, and Experiments}.



\newpage
\subsection*{Reviewer \#1 comments followed by the authors' answers:}

\begin{quote}

The paper presents an application of program verification and synthesis to select a combination of photovoltaic (PV) components that are optimally sized from a given set of available commercial components. The approach is compared to a commercial simulation tool, and generates PV systems that have better power characteristics.

The application of existing verification and synthesis techniques for solving the real-world problem of designing optimal PV systems is very interesting, and certainly in scope of VSTTE. However, the current presentation of the paper needs to be substantially improved.

First, it is not entirely clear who the paper is primarily aimed at. For a software verification conference, it assumes too much knowledge of PV systems and the physics involved, but on the other hand, includes too little detail about the actual verification and synthesis technique. For example, the background in section 2.2 is not accessible to a general verification audience. Rather, I would suggest to provide a much more high-level background on PV systems, and simply state that such a system can be modelled using a set of equations, possibly giving the (main) variables. Similarly, many of the PV-specific details in the evaluation are not accessible for a general verification audience, and need to be discussed at a higher level.

\begin{resposta} 
We thank the reviewer for these insightful comments and suggestions. We had to revise the Background and the Synthesizing Optimal Sizing sections to address the right conference attendants' profile. Our manuscript was entirely revised, and the PV sizing modeling was changed to a higher level of explanation, with a flowchart. The proposed synthesis algorithm followed the same principle. Besides that, in case of interest in the complete and detailed mathematical sizing of PV systems, we created a link to a 5-page PDF file that can be accessed.
\end{resposta}

Secondly, the problem that the paper is trying to solve needs to be stated precisely and early. In particular, it is not clear to me what the optimization objective is, i.e. what does 'optimal sizing' mean? Do you optimize for cost, or power consumption, or both? Currently, it is not until section 3 (page 8), that the paper seems to explain that the optimization is done w.r.t. to cost, but the evaluation seems to contradict this, because the commercial solution is regarded as not optimal, even though it has the lowest cost (in dollars).

\begin{resposta} 
We thank the reviewer again. Indeed, we had to revise the Abstract, the Introduction, and the Synthesizing Optimal Sizing sections in order to address more correctly what is PV optimal sizing. We must realize as well, and we added a highlight about this in the Results section. An optimal solution from a tool is not necessarily the same optimal of another tool, mainly when the database of equipment items (with different costs) are not the same. 
\end{resposta}

Then, I am confused about which verification, resp. synthesis, technique is actually being used. This is partially due to lack of details, but also because of inconsistencies in the paper. In different places, the paper describes the technique as CEGIS, or as model checking, or as optimization. 

\begin{resposta} 
We thank the reviewer again for this insightful comment. We had to revise some specific parts of the paper, where the CEGIS technique, or optimization appeared (Abstract, and Background sections). Our proposal is a technique based on CEGIS when considering the use of synthesis and automated verification. We aim to synthesize the optimal solution of a PV system (i.e., the technique produces an optimization). We expect that the revised sections below can clarify the issue, besides the next answer related to Algorithm 1. 

Into the Abstract section now we have: "Here we develop and evaluate an automated synthesis technique to obtain optimal sizing of PV systems based on Life Cycle Cost (LCC) analysis. The optimal solution is the lowest cost from a list of equipment that meets the electrical demands from a house, plus the replacement, operation, and maintenance costs over $20$ years. We propose a variant of the counterexample guided inductive synthesis (CEGIS) approach with two phases linking the technical and cost analysis to obtain the PV sizing optimization."

In the Background section now we have: "Summarizing: Our proposal is a technique based on CEGIS and we aim to synthesize the optimal solution of a PV system. Therefore, our technique produces an optimization."

\textcolor{red}{The two above sentences are new}.

\end{resposta}

Algorithm 1 to me seems to construct a constraint and then tries to solve it for the nondeterministic variables to obtain a solution, and to use essentially a linear search to find the minimum cost. Is this correct? If so, it is unclear to me how this fits with the CEGIS algorithm in Fig. 2, and where model checking is used.

\begin{resposta} 
We use four non-deterministic variables to index four matrices with complete datasheet information from an equipment item. We have four variables and four matrices: one to PV panels, one to batteries, one to the inverter, and one to the charge controller. Those non-deterministic variables are used during the search for the feasible solution and controlled by the statements \textbf{assume}. The candidate solution is proposed in the phase {\sc Synthesize} of the technique. For the {\sc Verify} phase, we performed a linear search for the lowest cost, and the result is based on FAIL or SUCCESS check from a cost that is linearly incremented in this model. The model checking is used during this {\sc Verify} phase. If the process produces FAIL, then an optimal solution is found. If SUCCESS is presented, i.e. the property holds, there is no feasible solution from the equipment list provided by the technique. \textcolor{red}{This explanation was included at page 9, in the end of section "Synthesizing Optimal Sizing of Stand-alone Solar Photovoltaic Systems".}
We added a future work at the end of the CONCLUSIONS section as well, related to the possibility of speeding up the {\sc Verify} phase through binary search or even using specific optimization targeted solvers (as $\nu Z$).
\end{resposta}


Finally, section 2.2 presents nonlinear continuous real-valued constraints. How can the discrete solvers used handle these constraints?   

\begin{resposta} 
We model these PV sizing constraints using floating-point arithmetic. It is just an approximation of the real numbers. However, in this work, we are not concerned with calculating the rounding error, which is negligible when considering the size of the physical quantities and the variables adopted. We added this information at the end of Section 2.2. Therefore, we thank the reviewer for the question and the possibility of clarifying this issue in our manuscript.
\end{resposta}

\end{quote}
\newpage


\subsection*{Reviewer \#2 comments followed by the authors' answers:} 

\begin{quote}

This paper presents a novel approach based on formal methods in order to obtain the optimal size of solar photovoltaic systems. The paper first introduces the basic formalization of such systems (in Section 2), then it discusses how these were modelled by means of formal methods (Section 3), and it then presents and discusses the experimental results (Section 4) comparing it with a commercial tool performing the same tasks using a different approach (HOMER).

Pros
--------

* This paper extends the application of formal methods to a novel scenario (aka optimization of solar photovoltaic systems).

* Overall, the formal approach seems to be sound and robust, even if I was not able to fully understand the background (see cons below).

* The authors have carried out very deep experiments. In particular, the algorithm was tested using 3 different state-of-the-art verifiers, and the results were compared with a commercial solution. In addition, since it is not straightforward to evaluate the results without a real system validation, the authors used a simulation tool.

\begin{resposta} 
We thank the reviewer for these comments.
\end{resposta}

Cons
--------

* For someone not familiar with the topic (like myself and, I would expect, 95\% of VSTTE community), it might be difficult to understand the overall setup, since Section 2 fails to provide some of the background (see minor comments below)

\begin{resposta} 
We thank the reviewer for this insightful comment and suggestion. You are correct; Reviewer \#1 also provided the same observation. We had to revise the Background, and the Synthesizing Optimal Sizing sections in order to address the right conference attendants profile. Our manuscript was revised, and the PV sizing modeling was changed to a higher level of explanation, including a flowchart in Section 2 (cf. Figure 4). In Section 3, the synthesis algorithm followed the same idea. Besides that, in case of interest in the complete and detailed mathematical sizing of PV systems, we created a link to a 5-page PDF complementary file that can be accessed as well.
\end{resposta}

* In general, I would say that the experimental results are not outstanding, but they show some potential in applying a total different approach to this field. However, the authors at the beginning state that the goal is to compute a solution with minimal cost, but then in Table 1 Homer computed cheapest solutions in all the cases, then it looks like the introduced approach is worse than existing commercial tools. Then the following discussion is a bit shallow: Table 2 "show that the synthesis solution is sound and complete, which answers EG1 and EG3", but EG3 is about "how does our formal synthesis tool compare to a specialized simulation tool?" (so I am still not sure if Homer is sound and complete and what's the comparison). Finally, the three drawbacks of Homer are discussed at the end of Section 4.4, but this is not about the costs of the system, and not connect to the three experimental goals.


\begin{resposta}
Indeed the optimal sizing means the lowest cost from a feasible (technical) solution. When we compare just the LCC, you are correct: HOMER Pro produces the lowest values in most case-studies. However, we prove that using a simulation tool (PVsyst) with the optimal produced from our technique and HOMER, our technical solution is better to meet the house's requirements. We added two sentences in order to clarify this issue.

Section 4.4 Results: ``The cost of every equipment item used in HOMER Pro is a US-based cost, without adaptation regardless of where the equipment is installed.''

Section 4.5 Comparison Between Formal Synthesis and HOMER Pro: ``Concerning the cost (LCC) present by both tools, HOMER Pro does not use the real cost for PV systems deployed in Brazil. The optimal solution presented by HOMER Pro is notoriously cheaper than our technique. However, considering that the aim is to present an optimal PV sizing solution that is feasible and closer to the market prices, our technique is more indicated.'' 
\end{resposta}

- Almost all equations end with a comma, please remove it

\begin{resposta}
Implemented as suggested.
\end{resposta}

- Page 2: specialist PV optimization software -$>$ specialized PV optimization software

\begin{resposta}
We have fixed this typo.
\end{resposta}

- In the introduction it is stated that formal methods for PV systems are unexplored in literature. I think a discussion about why this is the case, and what is intuitively needed to apply them to this new scenario would help the reader to understand the potential and impact of the novel approach


\begin{resposta}
We appreciate the reviewer's suggestion. Indeed only with background and experience, specifically in computer science and in electrical engineering, we can realize that the tool (formal synthesis) can solve, and with remarkable results, the PV system sizing issue. Therefore, we included a specific text in the Introduction section to address this particular comment:
``However, formal methods and its application to synthesize PV systems are not explored in literature, mainly because it is necessary background and experience, at the same time, in computer science and PV systems, what is not so common.''
\end{resposta}

- Section 2.2: some parts of this section are not well explained. To people that do not know this field, some choices feel completely arbitrary: why a factor of 20\% for losses is considered in equation 2? Similarly, why DOD is 75\%? I guess these are standard values, but maybe some citations of papers using the same parameters (or discussing them) might be helpful to convince the reader about the robustness of the formalization

\begin{resposta}
We agree with the reviewer. We missed the details about why those values are taken. Therefore, we revised the corresponding online text to: ``The $DOD$ is usually $25$\% for lead-acid batteries, and $80$\% for lithium batteries and represent an intrinsic and empirical feature of those type of batteries [Pinho and Galdino, 2014] in order to guarantee its lifetime''.
\end{resposta}

- page 6: Therefore, here in this study, the definition given here -$>$ Therefore, the definition given here

\begin{resposta}
Implemented as suggested.
\end{resposta}

- From equation 9 on I was lost. What are G, G\_ref, and T equation 9? Why you have T - 25 here? What is N\_PP in equation 10a?

\begin{resposta}
We have updated the entire paragraph in the complementary online file to explain the meaning of these variables. ``The short circuit reference information ($I_{sc,ref}$) from the manufacturer's solar panel must be corrected because field temperature ($T$) is higher than nominal or laboratory temperature ($25^{\circ}C$), and the PV system is temperature dependent, as described by Eq. (9) for the ambient short-circuit current from the PV panel. $G$ is the solar irradiance from the deployment site, and $G_{ref}$ is defined as $1000$ $W/m^{2}$ by the manufacturers.''
\end{resposta}

- Equation 6 is missing the 'x' to represent multiplications

\begin{resposta}
Implemented as suggested.
\end{resposta}

- Page 10: start-of-the-art -$>$ state-of-the-art
done

\begin{resposta}
Implemented as suggested.
\end{resposta}

\end{quote}
\newpage

\subsection*{Reviewer \#3 comments followed by the authors' answers:} 

\begin{quote}
The paper describes a system for optimally sizing PV systems.
A detailed account is given of both modeling parameters, evaluation method
and evaluation results. The details, covered in the paper, contain
a substantial amount of information on PV optimization and approaches
for solving the constraints. It uses methods developed in the FM
community, such as CBMC with MiniSAT, MathSat and Boolector and compares with
available commercial tools based on other technologies.
The substantial results are impressive and be inspirational.
There are also some drawbacks that makes the material not well
accessible:
- The description is very tedious and mixes a lot of low level
  information that is really only interesting to the authors
  and not suitable for a conference paper. More emphasis should
  be applied to the overall principles, and then details should be
  presented as instantiations.
  Essentially, parts of the paper, such as section 2.2 are not
  really useful. It is not possible for a reader to keep track of
  the many variables that are introduced. I don't see how they add
  conceptual value.
  Algorithm 1 also contains too many references to inlined variables.


\begin{resposta} 
We thank the reviewer for these insightful comments and suggestions. Those are the same observations did by Reviewer \#1 and \#2. We had to revise the Background, and the Synthesizing Optimal Sizing sections in order to address the right conference attendants profile. Our manuscript was revised, and the PV sizing modeling was changed to a higher level of explanation, including a flowchart in Section 2 (cf. Figure 4). In Section 3, the synthesis algorithm followed the same idea. Besides that, in case of interest in the complete and detailed mathematical sizing of PV systems, we created a link to a 5-page PDF complementary file that can be accessed as well.
\end{resposta}

 I do have some doubts about suitable the encodings that
  the authors choose, in particular, how relevant full fledged
  floating point reasoning is, but have no way to check.
  For a conference paper I am quite willing to give the paper a
  pass on this doubt as exposing details in the encodings could
  make the paper even less accessible.
  
\begin{resposta}
Concerning the floating-point reasoning: we model the PV sizing constraints using floating-point arithmetic. It is just an approximation of the real numbers. However, in this work, we are not concerned with calculating the rounding error, which is negligible when considering the size of the physical quantities and the variables adopted. We added this information at the end of Section 2.2. Therefore, we thank the reviewer for the question and the possibility to clarify this issue in the paper.
\end{resposta}  

- The paper contains several awkwardly formulated sentences. Examples
  are listed below.

The net effect is that the paper reads as a tour-de-force in "we did all of this hard work", but does not read "let us explain you something new and interesting from what we learned to inspire you".

Overall, based on the substance of the results, the paper remains adequate for the venue.

\begin{resposta}
We thank the reviewer.
\end{resposta}

Examples of awkward sentences:

Progress has been made worldwide; in particular, in 2017, the number
of people without electricity access fell below 1 billion thresholds
-$>$ Progress has been made worldwide; in particular, in 2017, the number
of people without electricity access fell below 1 billion

\begin{resposta}
Implemented as suggested.
\end{resposta}

they have the drawback of an incomplete coverage -$>$
they have the drawback of incomplete coverage

\begin{resposta}
Implemented as suggested.
\end{resposta}

are infeasible

\begin{resposta}
We have replace ``infeasible'' by ``not feasible''.
\end{resposta}

In 2017, a researcher suggested the application of formal methods to verify and
control the behaviour of computational devices in a smart grid [2].

\begin{resposta}
We have rewritten this sentence as ``In $2017$, Abate suggested the application of formal methods to verify and control the behavior of devices in a smart grid [2]''.
\end{resposta}


are still unexplored in literature
-$>$

\begin{resposta}
We have updated this sentence as ``However, formal methods and its application to synthesize PV systems are not explored in literature''.
\end{resposta}

using the traditional techniques
-$>$

\begin{resposta}
We have updated this sentence as ``Fig. 1 illustrates how to obtain the optimal sizing of a stand-alone PV system using the manual or simulation techniques and the proposed synthesis technique''.
\end{resposta}

For the automated synthesis
-$>$

\begin{resposta}
We have updated this sentence as ``However, when using automated synthesis, we also define the bound $k$ to restrict the design-space search''.
\end{resposta}


\end{quote}


\label{LastPage}

% \printbibliography
\end{document} 
